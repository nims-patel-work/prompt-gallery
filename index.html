<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Prompt Gallery — Gemini</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f7fbfd; --card:#fff; --muted:#6b7280; --accent:#06b6d4; --accent-dark:#089aa9;
    --radius:12px; --gap:14px; --pill-bg:#eef6f7;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:"Inter",system-ui,Arial;background:linear-gradient(180deg,#fbfdfe,#f0f6f9);color:#071028}
  .wrap{max-width:1200px;margin:18px auto;padding:14px}

  header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
  h1{margin:0;font-size:20px;font-weight:700}
  .controls{display:flex;gap:10px;align-items:center}
  .search{width:320px;max-width:44vw;padding:10px 12px;border-radius:12px;border:1px solid rgba(7,16,32,0.06);background:#fff;font-size:14px}

  /* tabs */
  .tabs{display:flex;gap:8px;margin:14px 0 8px;flex-wrap:wrap}
  .tab{padding:8px 12px;border-radius:999px;background:transparent;border:1px solid transparent;color:var(--muted);cursor:pointer;font-weight:600}
  .tab:hover{background:rgba(6,22,34,0.03)}
  .tab.active{background:linear-gradient(180deg,var(--accent),var(--accent-dark));color:white;box-shadow:0 8px 20px rgba(6,22,34,0.06)}
  .tab .count{margin-left:8px;font-size:12px;font-weight:700;opacity:.9}

  /* grid */
  .grid{display:grid;gap:var(--gap);margin-top:14px;grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));}
  @media (min-width:1200px){ .grid{ grid-template-columns: repeat(4, 1fr); } }
  @media (min-width:900px) and (max-width:1199px){ .grid{ grid-template-columns: repeat(3, 1fr); } }
  @media (min-width:600px) and (max-width:899px){ .grid{ grid-template-columns: repeat(2, 1fr); } }
  @media (max-width:599px){ .grid{ grid-template-columns: repeat(2, 1fr); gap:10px; } }

  .card{background:var(--card);border-radius:var(--radius);padding:10px;display:flex;flex-direction:column;gap:10px;box-shadow:0 12px 30px rgba(11,22,38,0.06);min-height:260px;overflow:hidden;position:relative}
  .imgwrap{position:relative;width:100%;height:220px;border-radius:10px;overflow:hidden;background:#f7fbfd;border:1px solid rgba(6,22,34,0.03)}
  .thumb{width:100%;height:100%;object-fit:cover;object-position:center;display:block}
  .expandBtn{position:absolute;bottom:10px;right:10px;background:rgba(0,0,0,0.6);border:none;color:#fff;width:36px;height:36px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:18px}
  .title{font-weight:700;font-size:15px}
  .prompt{font-size:13px;color:var(--muted);line-height:1.35;overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2}
  .meta-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .cat-pill{font-size:12px;padding:6px 8px;border-radius:8px;background:var(--pill-bg);color:#044}

  .actions{display:flex;gap:10px;margin-top:auto}
  .copyBtn{padding:8px 12px;border-radius:8px;border:none;background:linear-gradient(180deg,var(--accent),var(--accent-dark));color:#fff;font-weight:700;cursor:pointer}
  .copyBtn.copied{background:linear-gradient(180deg,#10b981,#059669)}

  footer{margin-top:16px;color:var(--muted);text-align:center;font-size:13px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Prompt Gallery — Gemini</h1>
      <div class="controls">
        <input id="search" class="search" placeholder="Search prompts..." />
      </div>
    </header>

    <div id="tabs" class="tabs"></div>
    <div id="grid" class="grid"></div>

    <footer>Update <code>prompts.json</code> with <code>category</code> for tabs.</footer>
  </div>

<script>
const PROMPTS_JSON_URL = 'prompts.json';
const grid = document.getElementById('grid');
const tabsEl = document.getElementById('tabs');
const search = document.getElementById('search');

let DATA = [];
let activeCategory = 'All';
let categories = ['All'];

function el(tag, cls){const e=document.createElement(tag);if(cls)e.className=cls;return e;}
function flashBtn(btn){const prev=btn.textContent;btn.textContent='Copied ✓';btn.classList.add('copied');setTimeout(()=>{btn.textContent=prev;btn.classList.remove('copied')},1200);}
function safeHtml(s){return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function normalize(s){return (s||'').toLowerCase();}

function buildCategories(){
  const set=new Map();
  DATA.forEach(it=>{const cat=it.category?String(it.category).trim():'Other';set.set(cat,(set.get(cat)||0)+1);});
  categories=['All',...Array.from(set.keys()).sort()];
  renderTabs(set);
}

function renderTabs(counts){
  tabsEl.innerHTML='';
  categories.forEach(cat=>{
    const btn=el('button','tab');
    btn.textContent=cat;
    const span=el('span','count');span.textContent=' '+(cat==='All'?DATA.length:(counts.get(cat)||0));
    btn.appendChild(span);
    if(cat===activeCategory)btn.classList.add('active');
    btn.onclick=()=>{activeCategory=cat;updateTabsUI();render(filtered());};
    tabsEl.appendChild(btn);
  });
}
function updateTabsUI(){[...tabsEl.children].forEach(b=>b.classList.toggle('active',b.textContent.startsWith(activeCategory)));}

function filtered(){
  let items=DATA.slice();
  if(activeCategory!=='All'){items=items.filter(it=>normalize(it.category||'Other')===normalize(activeCategory));}
  const q=normalize(search.value||'');
  if(q){items=items.filter(it=>((it.title||'')+' '+(it.prompt||'')).toLowerCase().includes(q));}
  items.sort((a,b)=>{const na=parseInt((a.id||'').match(/\\d+/)||0),nb=parseInt((b.id||'').match(/\\d+/)||0);return nb-na;});
  return items;
}

function render(items){
  grid.innerHTML='';
  if(!items.length){grid.textContent='No prompts found.';return;}
  items.forEach(it=>{
    const card=el('div','card');
    const iw=el('div','imgwrap');
    const img=el('img','thumb');img.src=it.image||'';img.alt=it.title||'image';img.onerror=()=>{img.src='https://via.placeholder.com/1200x800?text=No+Image'};
    const expand=el('button','expandBtn');expand.textContent='⤢';expand.onclick=e=>{e.stopPropagation();openNew(it);};
    iw.appendChild(img);iw.appendChild(expand);
    const title=el('div','title');title.textContent=it.title||'Untitled';
    const prompt=el('div','prompt');prompt.textContent=it.prompt||'';
    const meta=el('div','meta-row');const pill=el('span','cat-pill');pill.textContent=it.category||'Other';meta.appendChild(pill);
    const actions=el('div','actions');const copyBtn=el('button','copyBtn');copyBtn.textContent='Copy';copyBtn.onclick=async()=>{await navigator.clipboard.writeText(it.prompt||'');flashBtn(copyBtn);};actions.appendChild(copyBtn);
    card.append(iw,title,prompt,meta,actions);
    grid.appendChild(card);
  });
}

function openNew(it){
  const w=window.open('','_blank');if(!w)return alert('Popup blocked');
  const safeTitle=safeHtml(it.title||'');const safePrompt=safeHtml(it.prompt||'').replace(/\\n/g,'<br>');const imgUrl=it.image||'';
  w.document.write(`<!doctype html><html><head><meta charset='utf-8'/><meta name='viewport' content='width=device-width,initial-scale=1'/><title>Full view — ${safeTitle}</title>
  <style>body{margin:0;font-family:Inter,system-ui,Arial;background:#fff;color:#111;line-height:1.45}.wrap{max-width:1100px;margin:12px auto;padding:14px}.img{width:100%;max-height:70vh;object-fit:contain;border-radius:8px;background:#f3f4f6}h1{font-size:20px;margin:12px 0}.prompt{background:#f9fafb;padding:12px;border-radius:8px;white-space:pre-wrap}.actions{display:flex;gap:8px;margin-top:12px}.btn{padding:8px 12px;border-radius:8px;border:1px solid #d1d5db;background:#fff;cursor:pointer;font-weight:600}.btn-primary{background:linear-gradient(180deg,#06b6d4,#089aa9);color:#fff;border:none}.meta{margin-top:8px;color:#6b7280;font-size:13px}</style></head>
  <body><div class='wrap'><img class='img' src='${imgUrl}' alt='${safeTitle}'/><h1>${safeTitle}</h1><div class='meta'>Category: ${safeHtml(it.category||'Other')}</div><div class='prompt' id='p'>${safePrompt}</div><div class='actions'><button class='btn btn-primary' id='c'>Copy Prompt</button><button class='btn' id='x'>Close</button></div></div>
  <script>document.getElementById('c').onclick=async()=>{await navigator.clipboard.writeText(document.getElementById('p').innerText);const b=document.getElementById('c');const t=b.textContent;b.textContent='Copied ✓';setTimeout(()=>b.textContent=t,1200)};document.getElementById('x').onclick=()=>window.close();</script></body></html>`);
  w.document.close();
}

async function loadData(){
  try{const res=await fetch(PROMPTS_JSON_URL,{cache:'no-store'});DATA=await res.json();}catch(e){DATA=[{"id":"p1","title":"Sample","prompt":"Test","image":"https://via.placeholder.com/400x300","category":"Other"}];}
  buildCategories();updateTabsUI();render(filtered());
}

search.oninput=()=>render(filtered());
loadData();
</script>
</body>
</html>
